# Домашнее задание к занятию 12.6. «Репликация и масштабирование. Часть 1»

### Инструкция по выполнению домашнего задания

1. Сделайте fork [репозитория c шаблоном решения](https://github.com/netology-code/sys-pattern-homework) к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/gitlab-hw или https://github.com/имя-вашего-репозитория/8-03-hw).
2. Выполните клонирование этого репозитория к себе на ПК с помощью команды `git clone`.
3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
   - впишите вверху название занятия и ваши фамилию и имя;
   - в каждом задании добавьте решение в требуемом виде: текст/код/скриншоты/ссылка;
   - для корректного добавления скриншотов воспользуйтесь инструкцией [«Как вставить скриншот в шаблон с решением»](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md);
   - при оформлении используйте возможности языка разметки md. Коротко об этом можно посмотреть в [инструкции по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md).
4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`).
5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
6. Любые вопросы задавайте в чате учебной группы и/или в разделе «Вопросы по заданию» в личном кабинете.

Желаем успехов в выполнении домашнего задания.

---

### Задание 1

На лекции рассматривались режимы репликации master-slave, master-master, опишите их различия.

*Ответить в свободной форме.*

---

### Задание 2

Выполните конфигурацию master-slave репликации, примером можно пользоваться из лекции.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*

---

## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---

### Задание 3* 

Выполните конфигурацию master-master репликации. Произведите проверку.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*

---
### Задание 1


---

### Задание 2

Mysql ставился не через докер, а в lxc контейнеры с debian11 на домашнем гипервизоре proxmox. 

+ master-db 192.168.88.34
+ slave-db 192.168.88.33

Для одновременного конфигурирования 2 машин использовался [terminator](https://ubuntu.fandom.com/ru/wiki/Terminator) (первая ссылка в гугле, ставится через apt-install terminator)

Утобен тем, что есть бродкаст ввода в выбранные терминалы, как в iTerm для мака

Mysql8 ставился из офф пакета установки с [dev.mysql.com](https://dev.mysql.com/get/mysql-apt-config_0.8.25-1_all.deb)
```bash
wget https://dev.mysql.com/get/mysql-apt-config_0.8.25-1_all.deb
dpkg -i mysql-apt-config_0.8.25-1_all.deb
```
![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/mysql-inst.png)

апдейтим репозитории и инсталлим mysql

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/apt-update.png)

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/install-mysql.png)

все параметры mysql включаются в mysql.cnf с директорий *conf.d
```bash
cat mysql.cnf 
# * IMPORTANT: Additional settings that can override those from this file!
#   The files must end with '.cnf', otherwise they'll be ignored.
#
!includedir /etc/mysql/conf.d/
!includedir /etc/mysql/mysql.conf.d/
```
```bash
grep mysqld * -r
conf.d/mysqldump.cnf:[mysqldump]
mysql.conf.d/mysqld.cnf:[mysqld]
mysql.conf.d/mysqld.cnf:pid-file
```
правим mysqld.cnf

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/mysql-conf.png)

задаем пользователя, раздаем права

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/add%20replica%20user.png)


на слейве
```mysql
CHANGE MASTER TO MASTER_HOST='192.168.88.34', MASTER_USER='replica', MASTER_PASSWORD='123456', MASTER_LOG_FILE='binlog.002', MASTER_LOG_POS = 666;

GRANT REPLICATION SLAVE ON *.* TO 'replica'@'%';
```
![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/slave-conf.png)

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/slave-status.png)

проверяем репликацию

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/proverka.png)

не работает....поймали фатал:) 

```bash
Seconds_Behind_Master: NULL
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 13117
                Last_IO_Error: Fatal error: The replica I/O thread stops because source and replica have equal MySQL server ids; these ids must be different for replication to work (or the --replicate-same-server-id option must be used on replica but this does not always make sense; please check the manual before using it).

```

Дебажим.....и находим проблему - не проходим проверку на невнимательность...

```mysql
mysql> show variables like 'server_id'
    -> 
    -> ;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| server_id     | 1     |
+---------------+-------+
1 row in set (0.02 sec)
```

как оказалось, при редактировании конф файла забыл указать разные id-серверов. Поменял на слейве и рестартанул сервис. 

сразу проблема ушла, данные подтянулись после рестарта

![alt_text](https://github.com/ivanmalyshev/sdb-hw/blob/main/files/hw12-06/slave-ok.png)
---

## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---

### Задание 3* 


